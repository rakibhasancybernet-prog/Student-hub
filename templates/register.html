{% extends "base.html" %}
{% block content %}
<h2>Signup</h2>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% for category, msg in messages %}
    <p><b>{{ category }}:</b> {{ msg }}</p>
  {% endfor %}
{% endwith %}

<form method="POST">
  <input type="text" name="username" placeholder="Username" required>
  <input type="email" name="email" placeholder="Email" required>

  <hr>

  <label>Type a phrase (we will generate a strong password):</label>
  <input type="text" id="phrase" placeholder="e.g. i love you">

  <button type="button" onclick="genPass()">Generate Strong Password</button>

  <br><br>

  <label>Generated Password:</label>
  <input type="text" id="generated_password" name="password" readonly required>

  <br><br>

  <button type="submit">Create Account</button>
</form>

<p>Already have an account? <a href="{{ url_for('login') }}">Login</a></p>

<script>
async function genPass() {
  const phrase = document.getElementById("phrase").value.trim();
  const email = document.querySelector('input[name="email"]').value.trim();

  if (!phrase || !email) {
    alert("Please enter email and phrase first");
    return;
  }

  const formData = new FormData();
  formData.append("phrase", phrase);
  formData.append("email", email);

  const res = await fetch("/generate_password", { method: "POST", body: formData });
  const data = await res.json();

  if (!res.ok) {
    alert(data.error || "Failed to generate password");
    return;
  }

  document.getElementById("generated_password").value = data.password;
}
</script>
{% endblock %}
