{% extends "base.html" %}
{% block title %}Password Generator | Student Hub{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body p-4">
        <h1 class="h4 mb-2">Password Generator</h1>
        <p class="text-muted small mb-4">Generate a strong password and copy it instantly.</p>

        <div class="mb-3">
          <label class="form-label">Master Phrase</label>
          <input id="phrase" class="form-control" type="text" placeholder="e.g., my secret phrase" required>
          <div class="form-text">Use something memorable, but not guessable.</div>
        </div>

        <div class="mb-3">
          <label class="form-label">Email / Site Identifier</label>
          <input id="email" class="form-control" type="email" placeholder="e.g., you@gmail.com" required>
          <div class="form-text">Different email/site → different password.</div>
        </div>

        <button id="btnGenerate" class="btn btn-primary w-100" type="button">
          Generate Password
        </button>

        <hr class="my-4">

        <label class="form-label">Generated Password</label>
        <div class="input-group">
          <input id="generatedPw" class="form-control" type="text" readonly>
          <button id="btnCopy" class="btn btn-outline-secondary" type="button" disabled>Copy</button>
        </div>

        <p class="small text-warning mt-2 mb-0">
          Save this password. We won’t show it again.
        </p>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const phraseEl = document.getElementById("phrase");
  const emailEl = document.getElementById("email");
  const btnGen = document.getElementById("btnGenerate");
  const pwEl = document.getElementById("generatedPw");
  const btnCopy = document.getElementById("btnCopy");

  function setCopyState() {
    btnCopy.disabled = !pwEl.value;
  }

  btnGen.addEventListener("click", async () => {
    const phrase = phraseEl.value.trim();
    const email = emailEl.value.trim();

    if (!phrase || !email) {
      alert("Please enter both phrase and email.");
      return;
    }

    btnGen.disabled = true;
    btnGen.textContent = "Generating...";

    try {
      const res = await fetch("{{ url_for('generate_password') }}", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({ phrase, email })
      });

      const data = await res.json();
      if (!res.ok) {
        alert(data.error || "Something went wrong");
        return;
      }

      pwEl.value = data.password;
      setCopyState();
    } catch (e) {
      alert("Network error. Try again.");
    } finally {
      btnGen.disabled = false;
      btnGen.textContent = "Generate Password";
    }
  });

  btnCopy.addEventListener("click", async () => {
    try {
      await navigator.clipboard.writeText(pwEl.value);
      btnCopy.textContent = "Copied!";
      setTimeout(() => btnCopy.textContent = "Copy", 900);
    } catch (e) {
      alert("Copy failed. Please copy manually.");
    }
  });

  setCopyState();
</script>
{% endblock %}
